window.fly || (window.fly = {}); fly.simple || (fly.simple = {}); fly.simple.extendIf = (fly.simple.extendIf || function (A, $) { for (var C = 1; C < arguments.length; C++) { var _ = arguments[C]; for (var B in _) A[B] || (A[B] = _[B]) } return A }); var __isIE6 = navigator.userAgent.toLowerCase().indexOf("msie 6") > -1; fly.simple.extendIf(fly.simple, { $: function ($) { return $ && $.constructor == String ? document.getElementById($) : $ }, extend: function (A, $) { for (var C = 1; C < arguments.length; C++) { var _ = arguments[C]; for (var B in _) A[B] = _[B] } return A }, tempDiv: document.createElement("div"), emptyImg: __isIE6 ? "http://www.flyui.net/s.gif" : "data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==", isIE6: __isIE6, isType: function ($, _) { return Object.prototype.toString.call($) == "[object " + _ + "]" }, isArray: function ($) { return this.isType($, "Array") }, isStr: function ($) { return this.isType($, "String") }, isFun: function ($) { return this.isType($, "Function") }, ifFun: function ($) { return this.isFun($) ? $.apply(this, Array.prototype.slice.call(arguments, 1)) : $ }, falseFun: function () { return false }, ajax: window.$ ? window.$.ajax : null, ajaxOption: function (D, A, $) { var C = this; D = fly.simple.ifFun(D, $); if (D && D.constructor == String) this.url = D; else fly.simple.extend(this, D); this.url = fly.simple.ifFun(this.url, $ || this); if (this.url && this.url.constructor == String) this.url = fly.simple.format(this.url, $); var _ = this.callback, B = 0; this.callback = this.success = this.error = this.failure = function ($) { if (B) return; B = 1; _ && _.apply(this, arguments); A && A.apply(this, arguments) } }, format: function (A, $) { switch (typeof (A)) { case "string": var _ = arguments, B = arguments[arguments.length - 1] || this; return A.replace(/\{([^\}]{1,50})\}/g, function (C, A) { var $; if (/^\d+$/.test(A)) $ = _[parseInt(A) + 1]; else $ = B[A]; return $ == null ? "" : $ }) } }, insertElement: function (A, $, _, B) { if ($) $.insertAdjacentElement(B, _); else A.appendChild(_) }, insertBefore: function (A, $, _) { this.insertElement(A, $, _, "beforeBegin") }, insertAfter: function (A, $, _) { this.insertElement(A, $, _, "afterEnd") }, attachEvent: function (A, _, B) { function $($) { var _ = window.event; $ = window.event || $; if (!_) window.event = $; if (B.call(A, $, A) === false) { $.cancelBubble = true; $.stopPropagation && $.stopPropagation(); $.preventDefault && $.preventDefault() } if (!_) window.event = null } A.attachEvent ? A.attachEvent("on" + _, $) : A.addEventListener(_, $, false) }, bindEvents: function (_, $, B) { for (var A in $) _[A] && this.attachEvent(_[A], $[A], B) }, ie6aHover: function ($) { if ($) { $.href = "javascript:"; $.onclick = this.falseFun } }, changeCss: function (A, C, D) { var B = typeof (A) == "string", $ = B ? A : A.className, _ = C ? this.removeCss($, C) : $; _ = D ? this.addCss(_, D) : _; !B && _ != $ && (A.className = _); return _ }, addCss: function (A, C) { var B = typeof (A) == "string", $ = (B ? A : A.className).replace(/^ +| +$/g, ""); if ($ == "") { B || (A.className = C); return C } var _ = " " + $ + " "; C.replace(/\S+/g, function ($) { if (_.indexOf(" " + $ + " ") < 0) _ += " " + $ }); _ = _.replace(/ +/g, " ").replace(/^ +| +$/g, ""); !B && _ != $ && (A.className = _); return _ }, removeCss: function (A, C) { var B = typeof (A) == "string", $ = (B ? A : A.className).replace(/^ +| +$/g, ""); if ($ == "") return ""; var _ = " " + $.replace(/\s/g, "  ") + " "; C.replace(/\S+/g, function ($) { _ = _.replace(new RegExp("\\s" + $ + "\\s", "g"), " ") }); _ = _.replace(/ +/g, " ").replace(/^ +| +$/g, ""); !B && _ != $ && (A.className = _); return _ }, remove: function ($) { this.tempDiv.appendChild($); this.tempDiv.innerHTML = "" }, scope: function (_, $) { return function () { return _.apply($, arguments) } }, inherit: function (C, B, A) { var _ = B.prototype || B; function $() { } $.prototype = _; C.prototype = new $(); C.prototype.base = new $(); C.baseType = B instanceof Function ? B : $; B instanceof Function && this.extendIf(C, B); C.prototype.constructor = C; A && this.extend(C.prototype, A) }, each: function ($, A) { var C = this.isFun(A); if (this.isArray($)) for (var B = 0; B < $.length; B++) { var _ = $[B]; if ((C ? A(_) : _[A](_)) === false) return _ } else for (B in $) { _ = $[B]; if ((C ? A(_) : _[A](_)) === false) return _ } }, _eachAll: function (A, C, D, _, B) { if (B > _) return; if ((this.isFun(D) ? D(A, B) : A[D](A, B)) === false) { fly.simple.__eachAllStop = A; return false } B++; if (B > _) return; var $ = this.isFun(C) ? C(A) : A[C]; if ($ instanceof Array) for (var E = 0; E < $.length; E++) if (this._eachAll($[E], C, D, _, B) === false) return false }, eachAll: function (_, A, C, $) { if ($ === false || $ < 1) return; $ === true && ($ = 1000000); var B = this; if (this.isArray(_) ? this.each(_, function (_) { return B._eachAll(_, A, C, $, 1) }) : this._eachAll(_, A, C, $, 1) === false) return fly.simple.__eachAllStop }, queryAll: function (_, B, E, $, A) { var C = [], D = E; if (A == null || A > -1000000 == false) A = 1000000000; var F = this.isFun(D); E = function (_, $) { if (A > C.length) { if (F ? D(_, $) : D) C.push(_) } else return false }; this.eachAll.apply(this, arguments); return C }, eachParent: function (_, D, $, B) { ($ === true || $ == null) && ($ = 1000000); var C = 1, E = this.isFun(D); arguments.length < 4 && (B = "parentItem"); var A = this.isFun(B); while (C <= $ && (_ = (A ? B(_) : _[B]))) { if ((E ? D(_, C) : _[D](_, C)) === false) return _; C++ } }, indexOf: function (_, $) { for (var A = 0; A < $.length; A++) if ($[A] == _) return A; return -1 }, selectionMode: { none: "none", multi: "multi", single: "single", singleByLevel: "singleByLevel" }, checkModeStyle: { multi: "check", single: "radio", singleByLevel: "radio" }, checkStyle: { auto: "auto", check: "check", radio: "radio"} }); fly.simple.checkMode = fly.simple.selectionMode; fly.simple.itemsLayout = { "default": "default", flow: "flow" }; fly.simple.BaseItem = function () { var A = fly.simple, _ = function (_) { typeof (_) == "string" && (_ = { text: _ }); A.extend(this, _); this.items = []; var $ = _ && _.children || _.items || _.nodes; if ($ && $.length) { this.leaf = false; this.load($) } }, $ = { owner: _.prototype, isRoot: false, leaf: true, selected: false, handler: null, domCreated: false, icon: null, iconCss: null, load: function ($) { if (!$) return false; var _ = this; function B($) { _.items.push.apply(_.items, $); _.syncItems(); _.checkLeaf(_.items.length == 0) } A.isArray($) ? B($) : this.owner.requestData(this, B) }, items: Array.prototype, add: function ($) { this.insert.apply(this, Array.prototype.concat.apply([-1], arguments)) }, insert: function ($, _) { this.items.splice.apply(this.items, [$ < 0 ? this.items.length : Math.min($, this.items.length), 0].concat(_)); this.syncItems(); this.checkLeaf(this.items.length == 0) }, remove: function ($) { for (var B = 0; B < arguments.length; B++) { var _ = arguments[B]; if (typeof _ == "number") _ = this.items[_]; _.wrap && A.remove(_.wrap); this.owner.allItems.slice(A.indexOf(_, this.owner.allItems), 1); this.items.slice(A.indexOf(_, this.items), 1); delete this.owner.itemMap[_[this.owner.itemKey]] } }, itemsLayout: A.itemsLayout["default"], createPad: function () { if (!this.pad || this.pad.parentNode != this.wrap) { this.pad || (this.pad = this.owner.createPad(this)); this.wrap.appendChild(this.pad) } }, renderItems: function () { this.createPad(); for (var B = 0; B < this.items.length; B++) this.items[B].renderTo(this.owner, this.pad, B); if (this.lastItem != this.items[this.items.length - 1]) { var _ = this.owner.wrapCss + this.owner.lastItemCssPart, $ = this.owner.itemCss + this.owner.lastItemCssPart; if (this.lastItem) { A.removeCss(this.lastItem.wrap, _); A.removeCss(this.lastItem.panel, $) } this.lastItem = this.items[this.items.length - 1]; A.addCss(this.lastItem.wrap, _); A.addCss(this.lastItem.panel, $) } this.itemsRendered = true }, syncItems: function () { if (this.items.length) { for (var F = 0; F < this.items.length; F++) { var _ = this.items[F]; _ instanceof this.constructor || (_ = this.items[F] = new this.constructor(_)); _.parentItem = this; this.owner.join && this.owner.join(_) } if (this.isRoot && this.owner.rootVisible == false) this.eachItems(function ($) { $.parentItem = null }); if (this.domCreated) { if (!this.owner.quickly || this.itemsRendered) this.renderItems(); if (this.isRoot) { var E = this.firstItem; if (!this.owner.rootVisible && E != this.items[0]) { var B = this.owner.wrapCss + this.owner.firstItemCssPart, D = this.owner.itemCss + this.owner.firstItemCssPart; if (E && E.wrap) { A.removeCss(E.wrap, B); A.removeCss(E.panel, D) } E = this.firstItem = this.items[0]; if (E && E.wrap) { A.addCss(E.wrap, B); A.addCss(E.panel, D) } } var C = this.owner.wrapCss + "-single", $ = this.owner.itemCss + "-single"; E = this.singleItem; if (E && E.wrap) { A.removeCss(E.wrap, C); A.removeCss(E.panel, $) } if (this.items.length == 1) { E = this.singleItem = this.items[this.items.length - 1]; if (E && E.wrap) { A.addCss(E.wrap, C); A.addCss(E.panel, $) } } else this.lastItem = null } } } else this.firstItem = this.lastItem = null }, checkLeaf: function (B) { B = B == null ? this.leaf : !!B; if (B == this.leaf) return; this.leaf = B; if (this.panel) { var $ = this.owner.parentItemCss, _ = this.owner.leafItemCss; this.panel.className = A.removeCss(this.panel.className, B ? $ : _) + " " + (B ? _ : $) } }, parseIcon: function () { var $ = this.owner; if (this.icon) { if ($.iconFormat) this.icon = A.format($.iconFormat, this.icon, this) } else if (this.iconCss) { this.icon = A.emptyImg; this._iconCss = $.iconSizeCss } }, checkPosition: function (_, $) { if (_.childNodes[$] == this.wrap || _ == this.wrap) return true; A.insertBefore(_, _[$], this.wrap) }, setText: function ($) { this.text = $; this.textDom.innerHtml = $ }, markDom: function () { var B = this, _ = B.owner, C = this.panel.all || this.panel.getElementsByTagName("*"); for (var D = 0; D < C.length; D++) C[D].name && (this[C[D].name] = C[D]); if (this.iconDom && !this.icon && !this.iconCss) A.remove(this.iconDom); if (this.href) this.textDom.target = this.target || _.navTarget; else this.textDom.removeAttribute("href"); if (this.checkDom && this.checked) this.check(this.checked, false); if (this.isRoot) { _.style && (this.wrap.style.cssText += ";" + _.style); var $ = this.wrap.className + " " + (_.css || ""); _.checkMode != A.checkMode.none && ($ += " " + _.checkStylePart + _.checkStyle); _.showToggle && ($ += " " + _.toggleStyleCssPart + _.toggleStyle); _.showLine && ($ += " " + _.lineCss); this.wrap.className = $; this.createPad(); this.pad.className += " " + _.padCss + "-root" + (_.rootVisible ? "" : " " + _.padCss + "-root-hide"); if (!_.rootVisible) this.panel.parentNode.removeChild(this.panel); else this.panel.className += " " + _.itemCss + "-root"; if (_.useEffect) setTimeout(function () { B.wrap.className += " " + B.owner.effectCss; setTimeout(function () { B.owner.applyEffect() }, 10) }) } }, renderTo: function (A, _, $) { A.join(this); if (!this.domCreated) { if (A.onBeforeRender && A.onBeforeRender(this) == false) return false; this.parseIcon(); this.wrap = A.createWrap(this); this.panel || (this.panel = A.createPanel(this)); this.wrap.appendChild(this.panel); this.markDom(); this.bindEvents(); this.domCreated = true; this.syncItems(); this.expanded ? this.expand() : this.collapse() } this.checkPosition(_, $) }, expanded: false, toggle: function (A, _) { if (this.owner.onToggle && this.owner.onToggle(this) === false) return false; try { document.selection && document.selection.empty() } catch ($) { } this.expanded ? this.collapse() : this.expand(); this.owner.onToggled && this.owner.onToggled(this); if (_ == this.toggleDom) return false }, collapseAll: function ($) { var _ = true; this.eachAll(function ($) { $.collapse(); $.expanded && (_ = false) }, $ == null ? true : $); return _ }, collapse: function () { if (this.owner.onCollapse && this.owner.onCollapse(this) === false) return false; var $ = A.changeCss(this.wrap.className, this.owner.expandCss, this.owner.collapseCss); if (this.wrap.className != $) { this.items.length && this.owner.applyEffect(); this.wrap.className = $ } this.expanded = false; this.owner.onCollapsed && this.owner.onCollapsed(this) }, expandAll: function ($) { var _ = true; this.eachAll(function ($) { $.expand(); $.expanded || (_ = false) }, $ == null ? true : $); return _ }, expand: function ($) { if (this.owner.onExpand && this.owner.onExpand(this) === false) return false; var _ = A.changeCss(this.wrap.className, this.owner.collapseCss, this.owner.expandCss); if (this.wrap.className != _) { this.items.length && this.owner.applyEffect(); this.wrap.className = _ } this.expanded = true; if (!this.leaf && this.leaf != null) { this.items.length || this.owner.requestData(this, this.load); this.items.length && this.owner.quickly && !this.itemsRendered && this.renderItems() } if ($) A.eachParent(this, function ($) { $.expand() }, $); this.owner.onExpanded && this.owner.onExpanded(this) }, getSelectItems: function ($, C, B, _) { $ == null && ($ = true); return A.queryAll(_ ? this : this.items, "items", function (_) { return _.selected == $ }, B, C) }, select: function (_, B) { var C = typeof (_) == "object", D = this.owner; _ = C ? !this.selected : (_ == null ? true : !!_); if (D.selectionMode == A.selectionMode.none) return false; if (D.onSelect && D.onSelect(this, _, C) === false) return false; if (_ == false && B !== true && D.leastSelectionOne) if (D.selectionMode == A.selectionMode.multi) { var $ = D.selectedItems; if ($ == null || $.length == 0 || ($.length == 1 && $[0] == this)) return false } else return false; if (C) D.applyEffect(); if (_) { if (D.selectionMode == A.selectionMode.single) D.currentItem && D.currentItem != this && D.currentItem.select(false, true); else if (D.selectionMode == A.selectionMode.singleByLevel) this.parentItem && this.parentItem.currentItem && this.parentItem.currentItem != this && this.parentItem.currentItem.select(false, true); A.addCss(this.panel, D.selectedCss); D.currentItem = this; this.parentItem && (this.parentItem.currentItem = this); A.indexOf(this, D.selectedItems) < 0 && D.selectedItems.push(this) } else { A.removeCss(this.panel, D.selectedCss); this.parentItem && this.parentItem.currentItem == this && (this.parentItem.currentItem = null); D.currentItem == this && (D.currentItem = null); var E = A.indexOf(this, D.selectedItems); E > -1 && D.selectedItems.splice(E, 1) } this.selected = _; if (D.keepCheckAndSelectSync && ((this.checked == true) != _)) this.check(_, true); D.onSelected && D.onSelected(this, C) }, bindEvents: function () { var D = this, C = this.owner, F = this.owner.itemEvents; if (F) for (var _ in F) { var $ = F[_]; for (var B in $) this[_] && A.attachEvent(this[_], B, function ($) { return function (A, _) { return $.call(D, D, A, _) } } ($[B])) } A.bindEvents(this, C.toggleEvents, A.scope(this.toggle, this)); C.selectionMode == A.selectionMode.none || A.bindEvents(this, C.selectEvents, A.scope(this.select, this)); var E = this.handler || this.owner.itemHandler; E && A.attachEvent(this.panel, C.handlerEvent, function (_, $) { E.call(D, D, C, _, $) }); if (A.isIE6) A.ie6aHover(this.toggleDom) }, eachAll: function (A, _, $) { _ == null && (_ = false); if (_ === true || _ === false) return this.owner.eachAll(_ ? this : this.items, A, $); _ instanceof Array || (_ = _.split(",")); return this.eachAll(function ($) { for (var B = 0; B < _.length; B++) if (_[B] === $ || $.id === _[B]) return A($) }) }, eachItems: function ($) { return A.each(this.items, $) }, hidden: false, hide: function () { this.hidden = true; this.wrap.style.display = "none" }, show: function () { this.hidden = false; this.wrap.style.display = "" }, showAll: function ($) { var _ = true; this.eachAll(function ($) { $.show(); $.hidden && (_ = false) }, $ == null ? true : $); return _ }, hideAll: function ($) { var _ = true; this.eachAll(function ($) { $.hide(); $.hidden || (_ = false) }, $ == null ? true : $); return _ } }; A.extend(_.prototype, $); return _ } (); fly.simple.BaseList = function () { var simple = fly.simple, bTree = function ($) { simple.extend(this, $); $ || ($ = {}); this.itemMap || (this.itemMap = {}); this.allItems = []; this.selectedItems = []; typeof (this.checkCascade) != "object" && (this.checkCascade = bTree.buildCascade(this.checkCascade)); if (!$ || !($.root instanceof this.itemType)) { this.root = new this.itemType(simple.extend({}, this.defaults.root, typeof ($.root) == "object" ? $.root : { text: $.root })); this.root.leaf = false } if (this.rootVisible == "auto") this.rootVisible = !!this.root.text; this.root.isRoot = true; this.join(this.root); (this.items || this.nodes || this.data) && this.load(this.items || this.nodes || this.data); this.items = this.root.items; this.container && this.autoRender !== false && this.renderTo(this.container) }; bTree.buildCascade = function ($) { return { check: { parent: $, children: $ }, uncheck: { parent: $, children: $}} }; var pTree = { defaults: {}, rootVisible: "auto", quickly: false, itemKey: "id", itemMap: null, allItems: null, applyEffect: function (_) { if (this.useEffect && (this.effectStarted ^ _ != true) && this.rendered) { var A = this, B = A.root.wrap.filters; if (B && B.length) { for (var C = 0; C < B.length; C++) { try { B[C][_ === true ? "Play" : "Apply"]() } catch ($) { if (_) A.root.wrap.style.filter = "none"; return } } if (_ != true) { clearTimeout(this.effectHandle); this.effectHandle = setTimeout(function () { A.applyEffect(true) }, 5) } this.effectStarted = _ != true } } }, renderTo: function ($) { this.container = simple.$($ || this.container || document.body); if (!this.container) return false; this.root.renderTo(this, this.container); this.rendered = true }, join: function (_) { var $ = _.tree != this; _.tree = this; _.owner = this; _.parent = _.parentItem || _.owner; if (this.rootVisible || _ != this.root) { this.itemMap[_[this.itemKey]] = _; this.allItems.push(_) } return $ }, load: function ($) { this.root.load($) }, requestData: function (item, callback) { var me = this, process = function (data) { try { data && data.constructor == String && (data = eval("(" + data + ")")) } catch (e) { data = ["ERROR:" + e.message] } if (me.onRequestData) { var _d = me.onRequestData(data); if (_d !== undefined) data = _d } callback.call(item, data) }; if (this.async) fly.simple.ajax(new simple.ajaxOption(this.async, process, item)); else if (this.getItems) process(this.getItems(item)) }, createWrap: function ($) { !$.wrap && ($.wrap = document.createElement("div")); $.wrap.className = this.wrapCss + " " + ($.wrapCss || ""); return $.wrap }, createPanel: function (_) { var $ = document.createElement("div"), A = simple.format(this.textDomFormat instanceof Function ? (this.textDomFormat(_)) : this.textDomFormat, _); if (this.checkMode != "none" && _.checkMode != "none") this.checkboxPostion == "left" ? A = this.checkboxHtml + A : A += this.checkboxHtml; $.className = this.itemCss + " " + (_.css || "") + " " + (_.leaf === false ? this.parentItemCss : this.leafItemCss); $.innerHTML = (this.showToggle ? this.toggleButtonHtml : "") + A; return $ }, createPad: function (_) { var $ = document.createElement("div"); $.className = this.padCss + " " + (_.padCss || "") + (this.padCss + "-" + _.itemsLayout); return $ }, eachAll: function (_, A, $) { if (simple.isFun(_)) if (simple.isFun(A)) _ = _.call(this); else { $ = A; A = _; _ = null } if (_ == null) _ = this.rootVisible ? this.root : this.root.items; return simple.eachAll(_, "items", A, $) }, textDomFormat: '<a name="textDom" class=f-s-item-text href="{href}" title="{title}" id="{id}" ><img name="iconDom" class="f-s-item-icon {iconCss} {_iconCss}" src="{icon}" />{text}</a>', checkboxHtml: '<a unselectable="on" name="checkDom" class="f-s-item-check" ></a>', toggleButtonHtml: '<a unselectable="on" class=f-s-item-toggle name=toggleDom ></a>', checkboxPostion: "left", checkStyle: simple.checkStyle.auto, checkMode: simple.checkMode.none, checkCascade: { check: { parent: 0, children: 0 }, uncheck: { parent: 0, children: 0} }, useCheckHalf: true, selectionMode: simple.selectionMode.single, leastSelectionOne: false, selectEvents: { panel: "click" }, checkEvents: { checkDom: "click" }, toggleEvents: { toggleDom: "click", panel: "dblclick" }, keepCheckAndSelectSync: false, toggleStyleCssPart: "f-s-tree-toggle-", selectedCss: "f-s-item-selected", expandCss: "f-s-item-expand", collapseCss: "f-s-item-collapse", itemCss: "f-s-item", parentItemCss: "f-s-item-parent", leafItemCss: "f-s-item-leaf", wrapCss: "f-s-item-wrap", padCss: "f-s-item-pad", effectCss: "f-s-tree-effect", checkedCss: "f-s-item-checked", checkedHalfCss: "f-s-item-checked-half", uncheckHalfCss: "f-s-item-uncheck-half", checkStylePart: "f-s-t-check-", firstItemCssPart: "-first", lastItemCssPart: "-last", iconSizeCss: "f-s-icon-16", useEffect: true, navTarget: "_blank", showToggle: true, toggleStyle: "arrow", showLine: false, lineCss: "f-s-t-line", css: "", handlerEvent: "click", itemHandler: null }; bTree.cloneItemMethod = function (_, $) { simple.each($, function ($) { _[$] = function () { var _ = arguments[0] instanceof this.itemType, A = Array.prototype.slice.call(arguments, _ ? 1 : 0), B = _ ? arguments[0] : this.root; if (!_ && A[B[$].length - 1] == null) A[B[$].length - 1] = this.rootVisible; return B[$].apply(B, A) } }) }; bTree.cloneItemMethod(pTree, ["getSelectItems", "collapseAll", "expandAll", "showAll", "hideAll"]); simple.extend(bTree.prototype, pTree); return bTree } (); fly.simple.Tree = function () { var _ = fly.simple, $ = function ($) { _.BaseList.apply(this, arguments); this.checkMode || (this.checkMode = _.checkMode.multi); !this.checkMode || this.checkStyle == "auto" && (this.checkStyle = _.checkModeStyle[this.checkMode] || _.checkModeStyle.multi); _.selectionMode[this.selectionMode] || (this.selectionMode = _.selectionMode.single) }; $.defaults = { root: { expanded: true, wrapCss: "f-s-tree"} }; pTree = { defaults: $.defaults }; var A = _.BaseItem.prototype; $.Node = function ($) { _.BaseItem.apply(this, arguments); this.checkCascade != null && typeof (this.checkCascade) != "object" && (this.checkCascade = _.BaseList.buildCascade(this.checkCascade)) }; var B = { owner: $.prototype, checked: false, isCheckHalf: false, getCheckCascade: function ($, B) { var _ = $ ? "check" : "uncheck", A = B ? "children" : "parent"; cascade = this.checkCascade && this.checkCascade[_] && this.checkCascade[_][A]; cascade == null && (cascade = this.owner.checkCascade[_] && this.owner.checkCascade[_][A]); return cascade > 0 ? (cascade === true ? 1000000 : cascade) : -1 }, checkAll: function (A, $) { var _ = true; this.eachAll(function ($) { $.check(A, false); $.checked != A && (_ = false) }, $ == null ? true : $); if (this.owner.useCheckHalf) { this.cascadeCheckChildren(null, true, true); this.setHalf(); this.cascadeCheckParent(null, true, true) } return _ }, check: function (F, C) { var E = this, A = F, B = typeof (F) == "object", D = this.owner; B && (F = this.checked != true); if (D.onCheck && D.onCheck(this, F, B) === false) return false; if (B) D.applyEffect(); this.checked = F; if (C !== false) if (D.checkMode == _.checkMode.single) { if (F) { var $ = D.lastCheckItem; if ($ && $ != this) { $.check(false, false); if ($.parentItem != this.parentItem) $.cascadeCheckParent(null, true, true) } } this.cascadeCheckParent(null, true, true) } else if (D.checkMode == _.checkMode.singleByLevel) { if (this.parentItem && F) _.each(this.parentItem.items, function ($) { $ == E || $.check(false, false) }); D.useCheckHalf && this.setHalf(); this.cascadeCheckParent(null, true, true) } else { this.cascadeCheckChildren(F, this.getCheckCascade(F, true)); D.useCheckHalf && this.setHalf(); this.cascadeCheckParent(F, this.getCheckCascade(F, false)) } this.checked = F; if (F) D.lastCheckItem = this; if (this.panel) _.changeCss(this.panel, D.checkedCss + " " + D.checkHalfCss, F == 0.5 ? D.checkHalfCss : (F ? D.checkedCss : "")); if (D.keepCheckAndSelectSync && (this.selected != (F == true))) this.select(!!F, true); D.onChecked && D.onChecked(this, B); if (B) return false }, decideHalf: function (_, $) { if (!this.items.length) return false; $ == null && ($ = this.checked); var A = this.eachItems(function (_) { return _.checked == $ && _.isCheckHalf != true }); return A ? (this.checked ? 1 : -1) : 0 }, setHalf: function (B) { B == null && (B = this.decideHalf()); if (B == true) B = this.checked ? 1 : -1; else if (B == false) B = 0; if (this.isCheckHalf == B) return B; this.isCheckHalf = B; var A = "", $ = this.owner; if (B) A = $[this.checked ? "checkedHalfCss" : "uncheckHalfCss"]; _.changeCss(this.panel, $.checkedHalfCss + " " + $.uncheckHalfCss, A); return B }, cascadeCheckParent: function (A, $, D) { var C = null, B = this.owner; _.eachParent(this, function (_, E) { if (A != null && E <= $) if (_.checked != A) if (A) _.check(A, false); else if (!_.decideHalf(true, A)) _.check(A, false); else A = true; if (D != false && B.useCheckHalf) { if (_.setHalf(C)) C = true } else if (E > $) return false }) }, cascadeCheckChildren: function (_, $, A) { if (!this.items.length) return; if (_ != null) this.eachAll(function ($) { $.check(_, false) }, false, $); if (A != false && this.owner.useCheckHalf) this.eachAll(function ($) { $.setHalf() }, false, $) }, getCheckItems: function (C, B, A, $) { return _.queryAll($ ? this : this.items, "items", function ($) { return $.checked == C }, A, B) }, bindEvents: function () { A.bindEvents.apply(this, arguments); var $ = this.owner; _.bindEvents(this, $.checkEvents, _.scope(this.check, this)); if (_.isIE6) _.ie6aHover(this.checkDom) } }; _.BaseList.cloneItemMethod(pTree, ["getCheckItems", "checkAll"]); _.inherit($.Node, _.BaseItem, B); pTree.root = $.Node.prototype; pTree.itemType = $.Node; _.inherit($, _.BaseList, pTree); return $ } ()